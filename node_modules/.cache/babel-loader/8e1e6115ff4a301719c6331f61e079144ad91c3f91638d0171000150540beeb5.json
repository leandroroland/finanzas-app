{"ast":null,"code":"var _jsxFileName = \"/home/leandro/finanzas-app/src/components/RegisterSale/RegisterSale.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect } from 'react';\nimport { supabase } from '../../lib/supabaseClient';\nimport '../../assets/css/RegisterSale.css';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst RegisterSale = ({\n  onSale\n}) => {\n  _s();\n  const [items, setItems] = useState([]);\n  const [selectedItem, setSelectedItem] = useState(null);\n  useEffect(() => {\n    loadInventory();\n  }, []);\n  const loadInventory = async () => {\n    const {\n      data,\n      error\n    } = await supabase.from('inventory').select('*');\n    if (error) {\n      console.error('Error al cargar el inventario:', error);\n    } else {\n      setItems(data);\n    }\n  };\n  const handleSelectItem = item => {\n    setSelectedItem(item);\n  };\n  const handleSale = async () => {\n    if (!selectedItem) {\n      alert('Por favor, seleccione un servicio o producto.');\n      return;\n    }\n    const saleData = {\n      product_id: selectedItem.id,\n      name: selectedItem.name,\n      type: selectedItem.type,\n      price: selectedItem.price,\n      sale_time: new Date().toISOString() // Fecha y hora en formato ISO\n    };\n    if (selectedItem.type === 'product' && selectedItem.stock > 0) {\n      const {\n        error: updateError\n      } = await supabase.from('inventory').update({\n        stock: selectedItem.stock - 1\n      }).eq('id', selectedItem.id);\n      if (updateError) {\n        console.error('Error al actualizar el stock:', updateError);\n        return;\n      }\n    } else if (selectedItem.type === 'product' && selectedItem.stock <= 0) {\n      alert('No hay suficiente stock para este producto.');\n      return;\n    }\n    const {\n      error: insertError\n    } = await supabase.from('sales').insert([saleData]);\n    if (insertError) {\n      console.error('Error al registrar la venta:', insertError);\n    } else {\n      alert(`Venta registrada: ${selectedItem.name} - $${selectedItem.price}`);\n      onSale(); // Llama a la función onSale para recargar la lista de ventas inmediatamente\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"register-sale\",\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      children: \"Registrar Venta\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 67,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"ul\", {\n      id: \"added-items-list\",\n      className: \"list-group\",\n      children: items.map(item => /*#__PURE__*/_jsxDEV(\"li\", {\n        className: `list-group-item d-flex justify-content-between align-items-center ${(selectedItem === null || selectedItem === void 0 ? void 0 : selectedItem.id) === item.id ? 'active' : ''}`,\n        onClick: () => handleSelectItem(item),\n        children: [item.name, \" - \", item.type, \" - $\", item.price, item.type === 'product' && /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"badge bg-primary rounded-pill\",\n          children: item.stock\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 77,\n          columnNumber: 15\n        }, this)]\n      }, item.id, true, {\n        fileName: _jsxFileName,\n        lineNumber: 70,\n        columnNumber: 11\n      }, this))\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 68,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      className: \"btn btn-success w-100 mt-3\",\n      onClick: handleSale,\n      children: \"Registrar Venta\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 82,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 66,\n    columnNumber: 5\n  }, this);\n};\n_s(RegisterSale, \"u7YA/nWvAr1G4oZqETFS2G2jXmA=\");\n_c = RegisterSale;\nexport default RegisterSale;\nvar _c;\n$RefreshReg$(_c, \"RegisterSale\");","map":{"version":3,"names":["React","useState","useEffect","supabase","jsxDEV","_jsxDEV","RegisterSale","onSale","_s","items","setItems","selectedItem","setSelectedItem","loadInventory","data","error","from","select","console","handleSelectItem","item","handleSale","alert","saleData","product_id","id","name","type","price","sale_time","Date","toISOString","stock","updateError","update","eq","insertError","insert","className","children","fileName","_jsxFileName","lineNumber","columnNumber","map","onClick","_c","$RefreshReg$"],"sources":["/home/leandro/finanzas-app/src/components/RegisterSale/RegisterSale.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { supabase } from '../../lib/supabaseClient';\nimport '../../assets/css/RegisterSale.css';\n\nconst RegisterSale = ({ onSale }) => {\n  const [items, setItems] = useState([]);\n  const [selectedItem, setSelectedItem] = useState(null);\n\n  useEffect(() => {\n    loadInventory();\n  }, []);\n\n  const loadInventory = async () => {\n    const { data, error } = await supabase.from('inventory').select('*');\n    if (error) {\n      console.error('Error al cargar el inventario:', error);\n    } else {\n      setItems(data);\n    }\n  };\n\n  const handleSelectItem = (item) => {\n    setSelectedItem(item);\n  };\n\n  const handleSale = async () => {\n    if (!selectedItem) {\n      alert('Por favor, seleccione un servicio o producto.');\n      return;\n    }\n\n    const saleData = {\n      product_id: selectedItem.id,\n      name: selectedItem.name,\n      type: selectedItem.type,\n      price: selectedItem.price,\n      sale_time: new Date().toISOString(),  // Fecha y hora en formato ISO\n    };\n\n    if (selectedItem.type === 'product' && selectedItem.stock > 0) {\n      const { error: updateError } = await supabase\n        .from('inventory')\n        .update({ stock: selectedItem.stock - 1 })\n        .eq('id', selectedItem.id);\n\n      if (updateError) {\n        console.error('Error al actualizar el stock:', updateError);\n        return;\n      }\n    } else if (selectedItem.type === 'product' && selectedItem.stock <= 0) {\n      alert('No hay suficiente stock para este producto.');\n      return;\n    }\n\n    const { error: insertError } = await supabase.from('sales').insert([saleData]);\n\n    if (insertError) {\n      console.error('Error al registrar la venta:', insertError);\n    } else {\n      alert(`Venta registrada: ${selectedItem.name} - $${selectedItem.price}`);\n      onSale();  // Llama a la función onSale para recargar la lista de ventas inmediatamente\n    }\n  };\n\n  return (\n    <div className=\"register-sale\">\n      <h2>Registrar Venta</h2>\n      <ul id=\"added-items-list\" className=\"list-group\">\n        {items.map((item) => (\n          <li\n            key={item.id}\n            className={`list-group-item d-flex justify-content-between align-items-center ${selectedItem?.id === item.id ? 'active' : ''}`}\n            onClick={() => handleSelectItem(item)}\n          >\n            {item.name} - {item.type} - ${item.price}\n            {item.type === 'product' && (\n              <span className=\"badge bg-primary rounded-pill\">{item.stock}</span>\n            )}\n          </li>\n        ))}\n      </ul>\n      <button className=\"btn btn-success w-100 mt-3\" onClick={handleSale}>\n        Registrar Venta\n      </button>\n    </div>\n  );\n};\n\nexport default RegisterSale;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}