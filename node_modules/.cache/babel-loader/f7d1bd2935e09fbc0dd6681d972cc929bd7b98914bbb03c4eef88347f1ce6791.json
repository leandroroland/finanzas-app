{"ast":null,"code":"var _jsxFileName = \"/home/leandro/finanzas-app/src/components/ListSale/RegisterSale/RegisterSale.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect } from 'react';\nimport { supabase } from '../../../lib/supabaseClient';\nimport '../../assets/css/RegisterSale.css';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst RegisterSale = ({\n  onSale\n}) => {\n  _s();\n  const [items, setItems] = useState([]);\n  const [selectedItem, setSelectedItem] = useState(null);\n  useEffect(() => {\n    loadInventory();\n  }, []);\n  const loadInventory = async () => {\n    const {\n      data,\n      error\n    } = await supabase.from('inventory').select('*');\n    if (error) {\n      console.error('Error al cargar el inventario:', error);\n    } else {\n      setItems(data);\n    }\n  };\n  const handleSelectItem = item => {\n    setSelectedItem(item);\n  };\n  const handleSale = async () => {\n    if (!selectedItem) {\n      alert('Por favor, seleccione un servicio o producto.');\n      return;\n    }\n    const saleTimeInArgentina = new Date().toLocaleString(\"en-US\", {\n      timeZone: \"America/Argentina/Buenos_Aires\"\n    });\n    const saleData = {\n      product_id: selectedItem.id,\n      name: selectedItem.name,\n      type: selectedItem.type,\n      price: selectedItem.price,\n      sale_time: new Date(saleTimeInArgentina).toISOString()\n    };\n    if (selectedItem.type === 'product' && selectedItem.stock > 0) {\n      const {\n        error: updateError\n      } = await supabase.from('inventory').update({\n        stock: selectedItem.stock - 1\n      }).eq('id', selectedItem.id);\n      if (updateError) {\n        console.error('Error al actualizar el stock:', updateError);\n        return;\n      }\n    } else if (selectedItem.type === 'product' && selectedItem.stock <= 0) {\n      alert('No hay suficiente stock para este producto.');\n      return;\n    }\n    const {\n      error: insertError\n    } = await supabase.from('sales').insert([saleData]);\n    if (insertError) {\n      console.error('Error al registrar la venta:', insertError);\n    } else {\n      alert(`Venta registrada: ${selectedItem.name} - $${selectedItem.price}`);\n      onSale(); // Llama a la función onSale para recargar la lista de ventas\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"register-sale\",\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      children: \"Registrar Venta\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 69,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"ul\", {\n      id: \"added-items-list\",\n      className: \"list-group\",\n      children: items.map(item => /*#__PURE__*/_jsxDEV(\"li\", {\n        className: `list-group-item d-flex justify-content-between align-items-center ${(selectedItem === null || selectedItem === void 0 ? void 0 : selectedItem.id) === item.id ? 'active' : ''}`,\n        onClick: () => handleSelectItem(item),\n        children: [item.name, \" - \", item.type, \" - $\", item.price, item.type === 'product' && /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"badge bg-primary rounded-pill\",\n          children: item.stock\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 79,\n          columnNumber: 15\n        }, this)]\n      }, item.id, true, {\n        fileName: _jsxFileName,\n        lineNumber: 72,\n        columnNumber: 11\n      }, this))\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 70,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      className: \"btn btn-success w-100 mt-3\",\n      onClick: handleSale,\n      children: \"Registrar Venta\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 84,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 68,\n    columnNumber: 5\n  }, this);\n};\n_s(RegisterSale, \"u7YA/nWvAr1G4oZqETFS2G2jXmA=\");\n_c = RegisterSale;\nexport default RegisterSale;\nvar _c;\n$RefreshReg$(_c, \"RegisterSale\");","map":{"version":3,"names":["React","useState","useEffect","supabase","jsxDEV","_jsxDEV","RegisterSale","onSale","_s","items","setItems","selectedItem","setSelectedItem","loadInventory","data","error","from","select","console","handleSelectItem","item","handleSale","alert","saleTimeInArgentina","Date","toLocaleString","timeZone","saleData","product_id","id","name","type","price","sale_time","toISOString","stock","updateError","update","eq","insertError","insert","className","children","fileName","_jsxFileName","lineNumber","columnNumber","map","onClick","_c","$RefreshReg$"],"sources":["/home/leandro/finanzas-app/src/components/ListSale/RegisterSale/RegisterSale.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { supabase } from '../../../lib/supabaseClient';\nimport '../../assets/css/RegisterSale.css';\n\nconst RegisterSale = ({ onSale }) => {\n  const [items, setItems] = useState([]);\n  const [selectedItem, setSelectedItem] = useState(null);\n\n  useEffect(() => {\n    loadInventory();\n  }, []);\n\n  const loadInventory = async () => {\n    const { data, error } = await supabase.from('inventory').select('*');\n    if (error) {\n      console.error('Error al cargar el inventario:', error);\n    } else {\n      setItems(data);\n    }\n  };\n\n  const handleSelectItem = (item) => {\n    setSelectedItem(item);\n  };\n\n  const handleSale = async () => {\n    if (!selectedItem) {\n      alert('Por favor, seleccione un servicio o producto.');\n      return;\n    }\n\n    const saleTimeInArgentina = new Date().toLocaleString(\"en-US\", { timeZone: \"America/Argentina/Buenos_Aires\" });\n\n    const saleData = {\n      product_id: selectedItem.id,\n      name: selectedItem.name,\n      type: selectedItem.type,\n      price: selectedItem.price,\n      sale_time: new Date(saleTimeInArgentina).toISOString(),\n    };\n\n    if (selectedItem.type === 'product' && selectedItem.stock > 0) {\n      const { error: updateError } = await supabase\n        .from('inventory')\n        .update({ stock: selectedItem.stock - 1 })\n        .eq('id', selectedItem.id);\n\n      if (updateError) {\n        console.error('Error al actualizar el stock:', updateError);\n        return;\n      }\n    } else if (selectedItem.type === 'product' && selectedItem.stock <= 0) {\n      alert('No hay suficiente stock para este producto.');\n      return;\n    }\n\n    const { error: insertError } = await supabase.from('sales').insert([saleData]);\n\n    if (insertError) {\n      console.error('Error al registrar la venta:', insertError);\n    } else {\n      alert(`Venta registrada: ${selectedItem.name} - $${selectedItem.price}`);\n      onSale();  // Llama a la función onSale para recargar la lista de ventas\n    }\n  };\n\n  return (\n    <div className=\"register-sale\">\n      <h2>Registrar Venta</h2>\n      <ul id=\"added-items-list\" className=\"list-group\">\n        {items.map((item) => (\n          <li\n            key={item.id}\n            className={`list-group-item d-flex justify-content-between align-items-center ${selectedItem?.id === item.id ? 'active' : ''}`}\n            onClick={() => handleSelectItem(item)}\n          >\n            {item.name} - {item.type} - ${item.price}\n            {item.type === 'product' && (\n              <span className=\"badge bg-primary rounded-pill\">{item.stock}</span>\n            )}\n          </li>\n        ))}\n      </ul>\n      <button className=\"btn btn-success w-100 mt-3\" onClick={handleSale}>\n        Registrar Venta\n      </button>\n    </div>\n  );\n};\n\nexport default RegisterSale;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}